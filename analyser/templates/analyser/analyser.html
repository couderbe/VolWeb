{% extends "dashboard/base.html" %}
{% load static %}
{% block content%}

<script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-graph.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-data-adapter.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js"></script>
<link href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css" type="text/css" rel="stylesheet">
<link href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css" type="text/css" rel="stylesheet">
<style type="text/css">
    html,
    body,
    #chartdiv {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>
<link rel="stylesheet" href="{% static '/css/analyser.css' %}">

<div id="chartdiv"></div>


<script>
    var data = JSON.parse("{{data|escapejs}}");
    var chart = anychart.graph(data);
    var groups = JSON.parse("{{groups|escapejs}}");

    anychart.onDocumentReady(function () {


        chart.nodes().labels({ format: "{%name}" })

        chart.listen("click", function (e) {
            var tag = e.domTarget.tag;
            if (tag) {
                console.log(tag);
                if (tag.type === 'node') {
                    for (var i = 0; i < data.nodes.length; i++) {
                        if (data.nodes[i].id === tag.id) {
                            // var newMapping = mapping.filter("id", function (value) {
                            //     return value !== tag.id;
                            // });
                            // chart.data(newMapping);
                            // break;
                        }
                    }
                }
            }
        });

        // set settings for each group
        for (var i = 0; i < groups.length; i++) {
            // get group
            var group = chart.group(groups[i]);

            if (typeof group !== 'undefined') {
                // set group labels settings
                group
                    .labels()
                    .enabled(true)
                    .anchor('left-center')
                    .position('right-center')
                    .padding(0, -5)
                    .fontColor(anychart.palettes.defaultPalette[i]);
                // {enable:true,anchor:'left-center',position:'right-center',fontColor:anychart.palettes.defaultPalette[i]}

                // set group nodes stroke and fill
                group.stroke(anychart.palettes.defaultPalette[i]);
                group.fill(anychart.palettes.defaultPalette[i]);
            }
        }

        // set container id for the chart
        chart.container('chartdiv');
        // initiate chart drawing
        chart.draw();
    });

    $(document).ready(function () {
        $('.container').show();
        $('.container-fluid').show();
        $('.spinner-main').hide();

    });

</script>
{% endblock content %}